<h1>test</h1>

<script>
    (function () {
        const SECRET = 'kyoto';
        const TARGET_URL = 'https://probablynothing.xyz/kyoto';
        let buffer = '';

        const handleOpenHiddenRoute = () => {
            window.location.href = TARGET_URL;
        };

        window.addEventListener('keydown', (e) => {
            if (e.key.length !== 1) return; // Ð¿Ñ€Ð¾Ð¿ÑƒÑÐºÐ°ÐµÐ¼ ÑÐ¿ÐµÑ†ÐºÐ»Ð°Ð²Ð¸ÑˆÐ¸
            buffer += e.key.toLowerCase();
            if (buffer.length > SECRET.length) {
                buffer = buffer.slice(-SECRET.length);
            }
            if (buffer === SECRET) {
                handleOpenHiddenRoute();
            }
        });

        const checkOrientation = () => {
            if (window.matchMedia('(orientation: landscape)').matches) {
                handleOpenHiddenRoute();
            }
        };

        window.addEventListener('orientationchange', checkOrientation);

        const mq = window.matchMedia('(orientation: landscape)');
        if (mq.addEventListener) {
            mq.addEventListener('change', checkOrientation);
        } else if (mq.addListener) {
            mq.addListener(checkOrientation);
        }
    })();

    (function () {
        if (document.getElementById('tg-center-hotspot')) return;

        const pathname = window.location.pathname;

        console.log(pathname)

        const LINK = pathname === '/kyoto'
            ? 'https://pastebin.com/Sn8kGWHH'
            : 'https://t.me/+PLC7qZUv58JmMTBi';

        const SIZE_PX = 120;
        const el = document.createElement('div');
        el.id = 'tg-center-hotspot';

        Object.assign(el.style, {
            position: 'absolute',
            left: '50%',
            top: '50%',
            transform: 'translate(-50%, -50%)',
            width: SIZE_PX + 'px',
            height: SIZE_PX + 'px',
            zIndex: '9999',
            opacity: '0',
            background: 'transparent',
            cursor: 'pointer',
            pointerEvents: 'auto',
            userSelect: 'none'
        });
        el.setAttribute('aria-hidden', 'true');

        const openLink = () => {
            window.open(LINK, '_blank', 'noopener,noreferrer');
        };

        el.addEventListener('dblclick', (e) => {
            e.preventDefault();
            e.stopPropagation();
            openLink();
        }, { passive: false });

        let lastClick = 0;
        el.addEventListener('click', (e) => {
            const now = Date.now();
            if (now - lastClick < 300) {
                e.preventDefault();
                e.stopPropagation();
                openLink();
            }
            lastClick = now;
        }, { passive: false });

        document.documentElement.appendChild(el);
    })();

    window.code = (string) => {
        if(string === 'In the silence of Tokyo' || string === 'æ±äº¬ã®é™ã‘ã•ã®ä¸­ã§') {
            console.log('%c' + `        â£€â£¤â£¤â£¤â£¤â£€â €â €â €â €â €â €â €â €â €â € â €â €â£€â£¤â£¤â£¤â£¤â£€
â €â €â €â €â£°â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£·â¡€â €â €â €â €â €â €â €â €â¢ â£¾â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£†
â €â €â €â¢¸â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¦â €â €â €â €â €â €â£´â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â¡‡
â €â €â €â €â ™â »â¢¿â£¿â£¿â£¿â£¿â£¿â£¿â¡¿â ‹â €â €â €â €â €â € â ™â¢¿â£¿â£¿â£¿â£¿â£¿â£¿â ¿â Ÿâ ‹
â €â €â €â €   â ‰â ›â »â ¿â Ÿâ ‹â €â €â €â €â €â €â €â €â €   â ™â ¿â ¿â ›â ‹â €â €â €â €â €        \n\nð“†© LISTEN ð“†ª\n\nè€³ã‚’ã™ã¾ã›ã€é™å¯‚ã®ä¸­ã«ã‚³ãƒ¼ãƒ‰ã‚’â€‹è´ã‘ã€‚`, 'color: #00ff00; font-family: monospace; background: #000;');
            return
        } else {
            return 'wrong code'
        }
    }

    (function(){
        const DB_NAME = 'runtime-cache';
        const STORE_NAME = 'meta';
        const KEY = 'metrics';

        function openDb() {
            return new Promise((resolve, reject) => {
                const req = indexedDB.open(DB_NAME, 1);

                req.onupgradeneeded = () => {
                    const db = req.result;
                    if (!db.objectStoreNames.contains(STORE_NAME)) {
                        db.createObjectStore(STORE_NAME); // key -> value
                    }
                };

                req.onsuccess = () => resolve(req.result);
                req.onerror = () => reject(req.error);
            });
        }

        function getValue(db, key) {
            return new Promise((resolve, reject) => {
                const tx = db.transaction(STORE_NAME, 'readonly');
                const store = tx.objectStore(STORE_NAME);
                const req = store.get(key);

                req.onsuccess = () => resolve(req.result);
                req.onerror = () => reject(req.error);
            });
        }

        function setValue(db, key, value) {
            return new Promise((resolve, reject) => {
                const tx = db.transaction(STORE_NAME, 'readwrite');
                const store = tx.objectStore(STORE_NAME);
                store.put(value, key);

                tx.oncomplete = () => resolve();
                tx.onerror = () => reject(tx.error);
            });
        }

        async function bumpPageCounter() {
            try {
                const db = await openDb();
                const current = (await getValue(db, KEY)) || 0;
                const next = current + 1;

                await setValue(db, KEY, next);

                if (next % 12 === 0) {
                    window.open("https://pastebin.com/zWRRt6re", '_blank', 'noopener,noreferrer');
                }
            } catch (err) {
                console.error('IndexedDB error:', err);
            }
        }

        window.addEventListener('load', () => {
            bumpPageCounter();
        });
    })();
</script>


